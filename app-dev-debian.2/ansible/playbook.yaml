---

- hosts: localhost

  vars:

    #################
    # Manala - Sudo #
    #################

    manala_sudo_sudoers_exclusive: true
    manala_sudo_sudoers:
      - file: app
        config:
          - app: 'ALL=(ALL) NOPASSWD:ALL'

    #####################
    # Manala - Accounts #
    #####################

    manala_accounts_groups:
      - group:  docker
        system: true
      - group: app
        gid:   1337

    manala_accounts_users:
      - user:     app
        uid:      1337
        shell:    /bin/bash
        password: $1$hVMBHhKk$4zC4YK.KRk3Vy9fmLd7681 # Empty password generated by "mkpasswd -s -m md5"
        group:    app
        groups:
          - sudo
          - docker
        authorized_keys:
          - "{{ lookup('url', 'https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub') }}"

    ####################
    # Manala - Locales #
    ####################

    manala_locales_codes:
      - code:  en_US.UTF-8
        state: absent

    manala_locales_codes_default: C.UTF-8

    ####################
    # Manala - Ansible #
    ####################

    manala_ansible_config:
      - defaults:
          - force_color: 1
          - stdout_callback: full_skip
          - display_skipped_hosts: false
          - system_warnings: false
          - deprecation_warnings: false
          - command_warnings: false
          - fact_caching: jsonfile
          - fact_caching_connection: /var/cache/ansible
          - fact_caching_timeout: 86400
          - retry_files_enabled: false

    manala_ansible_hosts:
      - app_local:
        - localhost
      - app_dev:children:
        - app_local
      - app:children:
        - app_dev

    manala_ansible_group_vars:
      - file: app_dev.yaml
        vars:
          - env: dev

    manala_ansible_host_vars:
      - file: localhost.yaml
        vars:
          - ansible_connection: local
          - ansible_become: true
          - host_options:
              systemd: "{{ {
                'vagrant.virtualbox': True,
                'docker': False
              }[platform] }}"

    ###########################
    # Manala - Ansible Galaxy #
    ###########################

    manala_ansible_galaxy_roles:
      - manala.ansible-galaxy
      - manala.skeleton

  roles:
    - role: manala.sudo
    - role: manala.accounts
    - role: manala.locales
    - role: manala.ansible
    - role: manala.ansible-galaxy
