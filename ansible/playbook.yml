---

- hosts: all

  vars:

    # Set by packer
    # =============
    #_description: Foo bar
    #_version:     x.x.x
    #_type:        virtualbox|docker

    #################
    # Manala - Sudo #
    #################

    manala_sudo_sudoers_exclusive: true
    manala_sudo_sudoers:
      - file: app
        config:
          - app: ALL=NOPASSWD:ALL

    ##################
    # Manala - Users #
    ##################

    manala_users_groups:
      - app

    manala_users:
      - name:     root
        password: $1$hVMBHhKk$4zC4YK.KRk3Vy9fmLd7681 # Null password generated by "mkpasswd -s -m md5"
      - name:     app
        password: $1$hVMBHhKk$4zC4YK.KRk3Vy9fmLd7681 # Null password generated by "mkpasswd -s -m md5"
        group:    app
        groups:   ['sudo']
        authorized_keys:
          - "{{ lookup('url', 'https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub') }}"

    #####################
    # Manala - Skeleton #
    #####################

    manala_skeleton:     manala_app
    manala_skeleton_env: dev
    manala_skeleton_patterns_hashes:
      - skeleton_patterns

    ############
    # Skeleton #
    ############

    skeleton_patterns:
      motd: "{{ _description }} - {{ _version }}"

  roles:
    - role: manala.sudo
    - role: manala.users
    - role: manala.skeleton
